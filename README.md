# Создание моделей для отслеживания активности в воркаут зоне 

## Описание проекта

Данный проект представляет комплексное решение, которое формирует основу для дальнейшей интеграции в системы автоматизированного мониторинга воркаут площадок. Данное решение позволит решить проблему сбора аналитических метрик по загруженности площадки и распознаванию активности.

Мы предоставляем отдельные модули, которые готовы к использованию:
- Модуль детекции тренажеров, содержащий предобученную YOLOv11m для 11 классов: шведская стенка, брусья параллельные, перекладина для подтягиваний, рукоход змеевик, скамья для пресса, скамья для отжиманий, тумба для запрыгивания, рукоход, кольца гимнастические, перекладина для отжиманий;
- Модуль классификации упражнений для 22-х классов (проведены эксперименты с моделями s3d и легковесной LSTM);
- Модуль выдачи рекомендаций (MMPose, Gemini);

---

## 1. Модуль детекции тренажеров

Для данной задачи собран и размечен единственный в открытом доступе датасет — "Workout equipment for object detection", содержащий 1881 пару изображение-разметка.

![Пример 1](https://github.com/user-attachments/assets/c913c116-2d95-463e-8f15-515e32248bde)
![Пример 2](https://github.com/user-attachments/assets/54052ea3-97b3-4925-9b1b-f1fb2f2de56c)
![Пример 3](https://github.com/user-attachments/assets/9498c875-1bbc-4faf-895d-785c1c20607b)

### Метрики на тестовой выборке:
| Метрика | Значение |
|---------|----------|
| mAP@50  | 0.66     |
| mAP@50-90 | 0.40   |
| Precision | 0.84   |
| Recall  | 0.56     |

![Графики обучения](https://github.com/user-attachments/assets/de1fc42c-be15-4489-89b2-39c5e70782aa)

---

## 2. Модуль классификации упражнений

**Датасет:** [Workout Fitness Video Dataset](https://www.kaggle.com/datasets/hasyimabdillah/workoutfitness-video)

### Сравнение моделей на 6 классах (Accuracy):

| Упражнение          | S3D  | LSTM |
|---------------------|------|------|
| chest fly machine   | 0.97 | 0.95 |
| leg raises          | 0.86 | 0.88 |
| pull up             | 0.99 | 0.93 |
| push up             | 0.97 | 0.94 |
| squat               | 0.92 | 0.91 |
| tricep dips         | 0.89 | 0.92 |

### Конфигурация обучения:
- **Модель S3D:**
  - Количество эпох: 40
  - Время обучения: ~30 минут

- **Модель LSTM (легковесная):**
  - Количество эпох: 60
  - Время обучения: ~2 минуты

---

## 3. Модуль выдачи рекомендаций

Данный модуль анализирует технику отжиманий на основе видео, скелетной модели и фазового сравнения движений. На вход подаются видео эталонного выполнения и видео пользователя, на выходе формируются наглядные графики сравнения и текстовые рекомендации по технике. Сначала MMPose извлекает ключевые точки скелета для каждого кадра, после чего происходит нормализация скелета, вычисление углов в суставах и предобработка данных. Затем по среднему углу локтей автоматически выделяются отдельные повторы упражнения, которые приводятся к единой фазе выполнения (0–100%) для сравнения.

**Пример визуализации сравнения:**

![<img width="454" height="415" alt="image" src="https://github.com/user-attachments/assets/0a849b65-89e3-415c-82bf-e914bdf72d1d" />

! <img width="400" height="500" alt="image" src="https://github.com/user-attachments/assets/a4b08c83-6242-48b5-ab37-2661b5997e7a" />

Рекомендации генерируются с использованием LLM (Gemini). На основе численных метрик выделяются топ-6 проблемных мест, которые передаются в строго структурированном промпте модели. LLM формирует понятные, обоснованные и воспроизводимые советы по коррекции техники, не анализируя видео напрямую, а лишь интерпретируя готовые метрики. В результате пользователь получает персонализированные рекомендации по улучшению выполнения упражнений.

## Технологический стек
- Python 3.11
- YOLOv11m
- MMPose
- s3d
- Pytorch
- Docker
- numpy
- Pandas

## Быстрый старт

#### Запуск streamlit приложения
1. Установить зависимости requirements.txt из корневой папки (`pip install -r requirements.txt`).
2. Перейти в папку с кодом streamlit приложения - backend (`cd backend`)
3. Запустить приложение с помощью команды `streamlit run app.py`.
4. Ожидать запуска - будут скачаны базовые модели  YOLO и s3d, а потом модифицированы веса и запущено приложение.

#### Troubleshooting

1. Если модели не запускаются на cuda, то может быть проблема в зависимостях pytorch и cuda version для него. Необходимо подобрать работоспособные для устройства.
2. Если базовые веса для модели s3d не скачиваются, то может быть проблема в доступе к иностранному ресурсу. Необходимо устранить сетевые проблемы.

## Использование

1. Локальный запуск описан в секции Быстрый старт/
2. Для запуска с помощью Dockerfile необходимо запустить сборку образа Docker (может весить до 15 Гб), а после запустить на 8501 порту.

## Структура репозитория

Корневая папка:

* `Dockerfile` - инструкции для сборки образа Docker

* `requirements.txt` - основные зависимости для запуска приложения

* `/backend` - streamlit приложение и вся часть пайплайна для его работы

* `/lstm` - модуль классификации упражнений LSTM

* `/s3d` - модуль классификации упражнений s3d

* `/mmpose_mvp` - модуль выдачи рекомендаций

## Авторы

- Кирилл Демашов
- Алексеев Лев
- Якутин Сергей
- Лыков Дмитрий
- Солодникова София



















